#!/bin/bash

# simple script that generates control/task-description files
# with both different {sec-}blend-gen-control scripts for all existing Blends' 
# and compares the generated files

DEBUG=0

dodiff() {
    for file in $1/*
    do
        filename=`basename $file`
        if [ $filename != "readme" ]
        then
            if [ $DEBUG != 0 ] ; then
                echo "Comparing $1/$filename with $1-sec/$filename"
            fi
            diff $1/$filename $1-sec/$filename
        fi
    done
}

for blend in `psql -t udd -c 'SELECT blend FROM blends_metadata ORDER BY blend;'`
do  
    echo "Generating control files for $blend."
    ./blend-gen-control -S -D -c -b $blend
    ./sec-blend-gen-control -S -D -c -b $blend
    
    echo "Generating task-description files for $blend"
    ./blend-gen-control -S -D -t -b $blend
    ./sec-blend-gen-control -S -D -t -b $blend

    dodiff "control"
    echo ""
    dodiff "taskdesc"
    
    echo ""
done
